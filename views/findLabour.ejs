<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Labour - Labour Link</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/findLabour.css">
</head>
<body>
    <!-- Header -->
    <header class="find-labour-header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <a href="/" class="text-white me-3">
                        <i class="fas fa-arrow-left"></i>
                    </a>
                    <div>
                        <h1 class="h3 mb-1">Find Skilled Labour</h1>
                        <p class="mb-0">Connect with trusted professionals in your area</p>
                    </div>
                </div>
                <div>
                    <a href="/profile/customer" class="btn btn-outline-light me-2">
                        <i class="fas fa-user me-1"></i> My Profile
                    </a>
                    <a href="/logout" class="btn btn-light">
                        <i class="fas fa-sign-out-alt me-1"></i> Logout
                    </a>
                </div>
            </div>
        </div>
    </header>

    <div class="container-fluid">
        <div class="row">
            <!-- Filters Sidebar -->
            <div class="col-lg-3 col-md-4">
                <div class="filters-sidebar">
                    <div class="card filter-card">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-filter me-2"></i>Filters
                            </h5>
                        </div>
                        <div class="card-body">
                            <form id="filterForm" method="GET" action="/find-labour">
                                <!-- Search -->
                                <div class="filter-group">
                                    <label class="form-label">Search</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" name="search" 
                                               placeholder="Name, profession, or city..." 
                                               value="<%= searchParams.search %>">
                                        <button class="btn btn-outline-primary" type="submit">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Profession Filter -->
                                <div class="filter-group">
                                    <label class="form-label">Profession</label>
                                    <select class="form-select" name="profession">
                                        <option value="all">All Professions</option>
                                        <% professions.forEach(function(prof) { %>
                                            <option value="<%= prof %>" 
                                                    <%= searchParams.profession === prof ? 'selected' : '' %>>
                                                <%= prof %>
                                            </option>
                                        <% }); %>
                                    </select>
                                </div>

                                <!-- Rating Filter -->
                                <div class="filter-group">
                                    <label class="form-label">Minimum Rating</label>
                                    <select class="form-select" name="minRating">
                                        <option value="">Any Rating</option>
                                        <option value="4.5" <%= searchParams.minRating === '4.5' ? 'selected' : '' %>>4.5+ Stars</option>
                                        <option value="4.0" <%= searchParams.minRating === '4.0' ? 'selected' : '' %>>4.0+ Stars</option>
                                        <option value="3.5" <%= searchParams.minRating === '3.5' ? 'selected' : '' %>>3.5+ Stars</option>
                                        <option value="3.0" <%= searchParams.minRating === '3.0' ? 'selected' : '' %>>3.0+ Stars</option>
                                    </select>
                                </div>

                                <!-- Price Filter -->
                                <div class="filter-group">
                                    <label class="form-label">Max Hourly Rate ($)</label>
                                    <input type="number" class="form-control" name="maxPrice" 
                                           placeholder="e.g., 50" value="<%= searchParams.maxPrice %>"
                                           min="1" max="1000">
                                </div>

                                <!-- Sort Options -->
                                <div class="filter-group">
                                    <label class="form-label">Sort By</label>
                                    <select class="form-select" name="sortBy">
                                        <option value="rating" <%= searchParams.sortBy === 'rating' ? 'selected' : '' %>>Highest Rated</option>
                                        <option value="price-low" <%= searchParams.sortBy === 'price-low' ? 'selected' : '' %>>Price: Low to High</option>
                                        <option value="price-high" <%= searchParams.sortBy === 'price-high' ? 'selected' : '' %>>Price: High to Low</option>
                                        <option value="experience" <%= searchParams.sortBy === 'experience' ? 'selected' : '' %>>Most Experienced</option>
                                    </select>
                                </div>

                                <!-- Filter Actions -->
                                <div class="filter-actions">
                                    <button type="submit" class="btn btn-primary w-100 mb-2">
                                        <i class="fas fa-search me-2"></i>Apply Filters
                                    </button>
                                    <a href="/find-labour" class="btn btn-outline-secondary w-100">
                                        <i class="fas fa-times me-2"></i>Clear All
                                    </a>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="card filter-card mt-3">
                        <div class="card-body">
                            <h6 class="card-title">
                                <i class="fas fa-chart-bar me-2"></i>Quick Stats
                            </h6>
                            <div class="stats">
                                <div class="stat-item">
                                    <span class="stat-label">Professionals Found</span>
                                    <span class="stat-value"><%= labours.length %></span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Average Rating</span>
                                    <span class="stat-value">
                                        <% 
                                            const avgRating = labours.length > 0 ? 
                                                (labours.reduce((sum, labour) => sum + labour.rating, 0) / labours.length).toFixed(1) : 
                                                '0.0';
                                        %>
                                        <%= avgRating %>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-lg-9 col-md-8">
                <div class="main-content">
                    <!-- Results Header -->
                    <div class="results-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h2 class="mb-0">
                                Available Professionals
                                <% if (searchParams.search || searchParams.profession) { %>
                                    <small class="text-muted">
                                        (<%= labours.length %> results found)
                                    </small>
                                <% } %>
                            </h2>
                            <div class="view-options">
                                <button class="btn btn-outline-secondary active" id="gridView">
                                    <i class="fas fa-th"></i>
                                </button>
                                <button class="btn btn-outline-secondary" id="listView">
                                    <i class="fas fa-list"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Labour Cards Grid -->
                    <div class="labour-grid" id="labourGrid">
                        <% if (labours.length > 0) { %>
                            <% labours.forEach(function(labour) { %>
                                <div class="labour-card">
                                    <div class="card h-100">
                                        <div class="labour-card-header">
                                            <img src="<%= labour.profileImage || '/images/default-labour.png' %>" 
                                                 alt="<%= labour.name %>" 
                                                 class="labour-profile-img">
                                            <div class="online-indicator <%= Math.random() > 0.5 ? 'online' : 'offline' %>"
                                                 title="<%= Math.random() > 0.5 ? 'Online' : 'Offline' %>">
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="labour-info">
                                                <h5 class="labour-name"><%= labour.name %></h5>
                                                <span class="labour-profession badge bg-primary">
                                                    <%= labour.profession %>
                                                </span>
                                                <p class="labour-location text-muted">
                                                    <i class="fas fa-map-marker-alt me-1"></i>
                                                    <%= labour.address.city %>, <%= labour.address.state %>
                                                </p>
                                            </div>
                                            
                                            <div class="labour-rating">
                                                <div class="stars">
                                                    <% for(let i = 1; i <= 5; i++) { %>
                                                        <% if(i <= Math.floor(labour.rating)) { %>
                                                            <i class="fas fa-star"></i>
                                                        <% } else if(i === Math.ceil(labour.rating) && labour.rating % 1 !== 0) { %>
                                                            <i class="fas fa-star-half-alt"></i>
                                                        <% } else { %>
                                                            <i class="far fa-star"></i>
                                                        <% } %>
                                                    <% } %>
                                                </div>
                                                <span class="rating-text">
                                                    <%= labour.rating %> (<%= labour.totalReviews %> reviews)
                                                </span>
                                            </div>
                                            
                                            <div class="labour-pricing">
                                                <div class="price-item">
                                                    <span class="price-label">Hourly Rate:</span>
                                                    <span class="price-value">$<%= labour.wagePerHour %></span>
                                                </div>
                                                <div class="price-item">
                                                    <span class="price-label">Daily Rate:</span>
                                                    <span class="price-value">$<%= labour.wagePerDay %></span>
                                                </div>
                                            </div>
                                            
                                            <div class="labour-experience">
                                                <i class="fas fa-briefcase me-1"></i>
                                                <%= labour.experience %> experience
                                            </div>
                                        </div>
                                        <div class="card-footer">
                                            <div class="d-grid gap-2">
                                                <a href="/labour/<%= labour._id %>" class="btn btn-primary">
                                                    <i class="fas fa-eye me-2"></i>View Profile
                                                </a>
                                                <button class="btn btn-outline-success contact-btn" 
                                                        data-labour-id="<%= labour._id %>"
                                                        data-labour-name="<%= labour.name %>">
                                                    <i class="fas fa-phone me-2"></i>Contact
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <% }); %>
                        <% } else { %>
                            <div class="no-results text-center py-5">
                                <i class="fas fa-search fa-3x text-muted mb-3"></i>
                                <h3>No Professionals Found</h3>
                                <p class="text-muted">Try adjusting your search criteria or filters</p>
                                <a href="/find-labour" class="btn btn-primary">Clear All Filters</a>
                            </div>
                        <% } %>
                    </div>

                    <!-- Load More Button (for pagination) -->
                    <% if (labours.length > 0) { %>
                        <div class="text-center mt-4">
                            <button class="btn btn-outline-primary" id="loadMore">
                                <i class="fas fa-plus me-2"></i>Load More Professionals
                            </button>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Modal -->
    <div class="modal fade" id="contactModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Contact Professional</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Contact <span id="modalLabourName"></span> directly:</p>
                    <div class="contact-info">
                        <div class="contact-item">
                            <i class="fas fa-phone text-primary me-2"></i>
                            <span id="modalLabourPhone">Loading...</span>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-envelope text-primary me-2"></i>
                            <span id="modalLabourEmail">Loading...</span>
                        </div>
                    </div>
                    <div class="alert alert-info mt-3">
                        <i class="fas fa-info-circle me-2"></i>
                        Please be respectful and professional when contacting workers.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <a href="#" class="btn btn-primary" id="callButton">
                        <i class="fas fa-phone me-2"></i>Call Now
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Labour Link</h5>
                    <p class="mb-0">Connecting customers with skilled labour in their vicinity</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">&copy; 2023 Labour Link. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // View Toggle
            const gridView = document.getElementById('gridView');
            const listView = document.getElementById('listView');
            const labourGrid = document.getElementById('labourGrid');

            gridView.addEventListener('click', function() {
                labourGrid.classList.remove('list-view');
                labourGrid.classList.add('grid-view');
                gridView.classList.add('active');
                listView.classList.remove('active');
            });

            listView.addEventListener('click', function() {
                labourGrid.classList.remove('grid-view');
                labourGrid.classList.add('list-view');
                listView.classList.add('active');
                gridView.classList.remove('active');
            });

            // Contact Modal
            const contactModal = new bootstrap.Modal(document.getElementById('contactModal'));
            const contactBtns = document.querySelectorAll('.contact-btn');

            contactBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const labourId = this.getAttribute('data-labour-id');
                    const labourName = this.getAttribute('data-labour-name');
                    
                    document.getElementById('modalLabourName').textContent = labourName;
                    
                    // In a real app, you'd fetch labour details via AJAX
                    // For now, we'll simulate it
                    fetchLabourContactInfo(labourId);
                    
                    contactModal.show();
                });
            });

            function fetchLabourContactInfo(labourId) {
                // Simulate API call - in real app, make AJAX request to backend
                setTimeout(() => {
                    document.getElementById('modalLabourPhone').textContent = '+91-98765XXXXX';
                    document.getElementById('modalLabourEmail').textContent = 'professional@example.com';
                    
                    const callButton = document.getElementById('callButton');
                    callButton.href = 'tel:+919876543210';
                }, 500);
            }

            // Load More functionality
            const loadMoreBtn = document.getElementById('loadMore');
            if (loadMoreBtn) {
                loadMoreBtn.addEventListener('click', function() {
                    this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Loading...';
                    this.disabled = true;
                    
                    // Simulate loading more data
                    setTimeout(() => {
                        alert('In a real application, this would load more professionals from the server.');
                        this.innerHTML = '<i class="fas fa-plus me-2"></i>Load More Professionals';
                        this.disabled = false;
                    }, 1500);
                });
            }

            // Auto-submit form when certain filters change
            const autoSubmitFilters = document.querySelectorAll('select[name="profession"], select[name="minRating"], select[name="sortBy"]');
            autoSubmitFilters.forEach(select => {
                select.addEventListener('change', function() {
                    document.getElementById('filterForm').submit();
                });
            });
        });
    </script>
</body>
</html>